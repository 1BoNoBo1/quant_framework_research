# ==============================================
# FRAMEWORK QUANTITATIF PRODUCTION - MAKEFILE COMPLET
# Framework de trading quantitatif avec validation institutionnelle
# Architecture async native, 29 modules, 13,000+ lignes de code
# ==============================================

SHELL := /bin/bash
.ONESHELL:
.DEFAULT_GOAL := help

# Variables
PROJECT_NAME := quant-stack-production
PYTHON := python3
VENV_DIR := .venv
VENV_PYTHON := $(VENV_DIR)/bin/python3
VENV_PIP := $(VENV_DIR)/bin/pip

# Couleurs pour l'affichage
RED := \033[0;31m
GREEN := \033[0;32m
YELLOW := \033[0;33m
BLUE := \033[0;34m
PURPLE := \033[0;35m
CYAN := \033[0;36m
WHITE := \033[0;37m
NC := \033[0m # No Color

# ==============================================
# AIDE COMPL√àTE
# ==============================================

.PHONY: help
help: ## Aide compl√®te du framework quantitatif
	@echo -e "${CYAN}================================================================${NC}"
	@echo -e "${CYAN}    üöÄ FRAMEWORK QUANTITATIF PRODUCTION - GUIDE COMPLET${NC}"
	@echo -e "${CYAN}================================================================${NC}"
	@echo -e "${WHITE}Framework de trading quantitatif avec validation institutionnelle${NC}"
	@echo -e "${WHITE}Architecture async native ‚Ä¢ 29 modules ‚Ä¢ Standards hedge fund${NC}"
	@echo ""
	@echo -e "${PURPLE}üéØ D√âMARRAGE RAPIDE:${NC}"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | grep -E "(setup|quick|start|workflow)" | awk 'BEGIN {FS = ":.*?## "}; {printf "  ${GREEN}%-25s${NC} %s\n", $$1, $$2}'
	@echo ""
	@echo -e "${PURPLE}üìä PIPELINE QUANTITATIF:${NC}"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | grep -E "(pipeline|data|features|alphas)" | awk 'BEGIN {FS = ":.*?## "}; {printf "  ${GREEN}%-25s${NC} %s\n", $$1, $$2}'
	@echo ""
	@echo -e "${PURPLE}üèõÔ∏è VALIDATION INSTITUTIONNELLE:${NC}"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | grep -E "(validation|walkforward|backtest|overfitting)" | awk 'BEGIN {FS = ":.*?## "}; {printf "  ${GREEN}%-25s${NC} %s\n", $$1, $$2}'
	@echo ""
	@echo -e "${PURPLE}üß† STRAT√âGIES ALPHA:${NC}"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | grep -E "(alpha|strategy|dmn|mean|funding)" | awk 'BEGIN {FS = ":.*?## "}; {printf "  ${GREEN}%-25s${NC} %s\n", $$1, $$2}'
	@echo ""
	@echo -e "${PURPLE}üìà MONITORING & MLFLOW:${NC}"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | grep -E "(mlflow|monitor|track|status)" | awk 'BEGIN {FS = ":.*?## "}; {printf "  ${GREEN}%-25s${NC} %s\n", $$1, $$2}'
	@echo ""
	@echo -e "${PURPLE}üîß D√âVELOPPEMENT & TESTS:${NC}"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | grep -E "(test|dev|debug|bench)" | awk 'BEGIN {FS = ":.*?## "}; {printf "  ${GREEN}%-25s${NC} %s\n", $$1, $$2}'
	@echo ""
	@echo -e "${PURPLE}üßπ MAINTENANCE:${NC}"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | grep -E "(clean|status|info)" | awk 'BEGIN {FS = ":.*?## "}; {printf "  ${GREEN}%-25s${NC} %s\n", $$1, $$2}'
	@echo ""
	@echo -e "${YELLOW}üí° D√©marrage recommand√©: ${GREEN}make setup-complete && make pipeline-full${NC}"

# ==============================================
# INSTALLATION & SETUP
# ==============================================

.PHONY: setup-complete
setup-complete: ## Installation compl√®te du framework (recommand√©)
	@echo -e "${CYAN}üöÄ INSTALLATION FRAMEWORK QUANTITATIF COMPLET${NC}"
	@echo -e "${YELLOW}üì¶ Cr√©ation environnement virtuel...${NC}"
	@$(PYTHON) -m venv $(VENV_DIR)
	@$(VENV_PIP) install --upgrade pip setuptools wheel
	@echo -e "${YELLOW}üì¶ Installation stack quantitatif...${NC}"
	@$(VENV_PIP) install pandas>=2.0 numpy>=1.24 scipy>=1.10
	@$(VENV_PIP) install scikit-learn>=1.3 torch>=2.0
	@echo -e "${YELLOW}üì¶ Installation MLOps...${NC}"
	@$(VENV_PIP) install mlflow>=2.8 
	@echo -e "${YELLOW}üì¶ Installation APIs crypto...${NC}"
	@$(VENV_PIP) install ccxt>=4.0 python-binance>=1.0
	@echo -e "${YELLOW}üì¶ Installation async stack...${NC}"
	@$(VENV_PIP) install aiofiles aiohttp asyncio-mqtt
	@echo -e "${YELLOW}üì¶ Installation visualisation...${NC}"
	@$(VENV_PIP) install matplotlib seaborn plotly
	@echo -e "${YELLOW}üì¶ Installation utilitaires...${NC}"
	@$(VENV_PIP) install pyyaml python-dotenv tqdm rich
	@mkdir -p {data/{raw,processed,features,artifacts},logs,mlruns,cache,deploy}
	@echo -e "${GREEN}‚úÖ Installation compl√®te termin√©e${NC}"
	@echo -e "${YELLOW}üí° Testez avec: make pipeline-demo${NC}"

.PHONY: setup-dev
setup-dev: setup-complete ## Installation environnement d√©veloppement
	@echo -e "${CYAN}üõ†Ô∏è Setup d√©veloppement...${NC}"
	@$(VENV_PIP) install pytest pytest-asyncio black flake8 mypy jupyter
	@$(VENV_PIP) install pytest-cov pre-commit
	@echo -e "${GREEN}‚úÖ Environnement d√©veloppement pr√™t${NC}"

.PHONY: setup-production
setup-production: setup-complete ## Setup production avec monitoring
	@echo -e "${CYAN}üè≠ Setup production...${NC}"
	@$(VENV_PIP) install uvicorn fastapi prometheus-client
	@$(VENV_PIP) install redis celery
	@echo -e "${GREEN}‚úÖ Environnement production pr√™t${NC}"

# ==============================================
# PIPELINE QUANTITATIF COMPLET
# ==============================================

.PHONY: pipeline-full
pipeline-full: mlflow-start-bg ## Pipeline quantitatif complet (point d'entr√©e principal)
	@echo -e "${CYAN}‚ö° PIPELINE QUANTITATIF COMPLET${NC}"
	@echo -e "${YELLOW}üéØ Architecture async native - UN SEUL asyncio.run()${NC}"
	@sleep 3  # Attendre d√©marrage MLflow
	@source $(VENV_DIR)/bin/activate && $(PYTHON) orchestration/async_master_pipeline.py

.PHONY: pipeline-hybrid
pipeline-hybrid: mlflow-start-bg ## Pipeline hybride (async + modules r√©els)
	@echo -e "${CYAN}üî• PIPELINE HYBRIDE - PERFORMANCE + MODULES R√âELS${NC}"
	@echo -e "${YELLOW}üéØ Async performance + vrais backtests${NC}"
	@sleep 3  # Attendre d√©marrage MLflow
	@source $(VENV_DIR)/bin/activate && $(PYTHON) orchestration/hybrid_async_pipeline.py --symbols BTCUSDT ETHUSDT --max-concurrent 3

.PHONY: pipeline-no-mlflow
pipeline-no-mlflow: ## Pipeline hybride sans MLflow (test rapide)
	@echo -e "${CYAN}‚ö° PIPELINE SANS MLFLOW (TEST RAPIDE)${NC}"
	@echo -e "${YELLOW}üéØ Test architecture sans d√©pendance MLflow${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) orchestration/hybrid_no_mlflow_pipeline.py --symbols BTCUSDT --days 30

.PHONY: workflow-complete
workflow-complete: clean-cache mlflow-start-bg pipeline-hybrid validation-complete monitor-portfolio-final features-export-final report-consolidate mlflow-stop ## Workflow complet avec orchestration, validation, monitoring et export
	@echo -e "${GREEN}üéâ WORKFLOW QUANTITATIF TERMIN√â${NC}"
	@echo -e "${YELLOW}üìä Consultez les r√©sultats dans data/artifacts/ et logs/${NC}"
	@echo -e "${CYAN}üõ°Ô∏è Validation institutionnelle incluse${NC}"
	@echo -e "${MAGENTA}üìà Monitoring portfolio et export features termin√©s${NC}"

.PHONY: pipeline-demo
pipeline-demo: ## D√©mo pipeline avec simulation
	@echo -e "${CYAN}üé¨ D√âMO PIPELINE QUANTITATIF${NC}"
	@$(PYTHON) main_async.py --simulate
	@echo -e "${GREEN}‚úÖ D√©mo termin√©e - V√©rifiez les r√©sultats ci-dessus${NC}"

.PHONY: pipeline-validate
pipeline-validate: ## Validation architecture pipeline
	@echo -e "${CYAN}üß™ VALIDATION PIPELINE${NC}"
	@$(PYTHON) main_async.py --validate

.PHONY: pipeline-custom
pipeline-custom: ## Pipeline avec configuration personnalis√©e
	@echo -e "${CYAN}‚öôÔ∏è Pipeline Configuration Personnalis√©e${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) main_async.py --symbols "BTCUSDT,ETHUSDT,ADAUSDT" --max-concurrent 8

# ==============================================
# COLLECTE DE DONN√âES
# ==============================================

.PHONY: data-fetch
data-fetch: ## Collecte donn√©es crypto (OHLCV + funding)
	@echo -e "${CYAN}üìä Collecte Donn√©es Crypto${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.data.collector --symbols BTCUSDT,ETHUSDT

.PHONY: data-crypto
data-crypto: ## Gestionnaire donn√©es crypto avanc√©
	@echo -e "${CYAN}üí∞ Donn√©es Crypto Avanc√©es${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.data_sources.crypto_fetcher

.PHONY: data-async
data-async: ## Test gestionnaire donn√©es async
	@echo -e "${CYAN}‚ö° Gestionnaire Donn√©es Async${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.utils.async_data

# ==============================================
# FEATURE ENGINEERING
# ==============================================

.PHONY: features-build
features-build: ## Construction features techniques + ML
	@echo -e "${CYAN}üîß Feature Engineering${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.features.feature_engineer

# Target supprim√© - utiliser features-export-final

# ==============================================
# STRAT√âGIES ALPHA
# ==============================================

.PHONY: alpha-dmn
alpha-dmn: ## Alpha DMN LSTM (Deep Market Network)
	@echo -e "${CYAN}üß† Alpha DMN LSTM${NC}"
	@echo -e "${YELLOW}Architecture transformer avec attention multi-head${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.alphas.dmn_model

.PHONY: alpha-meanrev
alpha-meanrev: ## Alpha Mean Reversion adaptif
	@echo -e "${CYAN}üîÑ Alpha Mean Reversion${NC}"
	@echo -e "${YELLOW}Multi-timeframe avec ML optimization${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.alphas.mean_reversion

.PHONY: alpha-funding
alpha-funding: ## Alpha Funding Rate Arbitrage
	@echo -e "${CYAN}üí± Alpha Funding Arbitrage${NC}"
	@echo -e "${YELLOW}Pr√©diction ML cycles funding crypto${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.alphas.funding_strategy

.PHONY: alphas-all
alphas-all: alpha-dmn alpha-meanrev alpha-funding ## Entra√Ænement tous les alphas

# ==============================================
# VALIDATION INSTITUTIONNELLE
# ==============================================

.PHONY: validation-walkforward
validation-walkforward: ## Walk-forward analysis (90 p√©riodes)
	@echo -e "${CYAN}üîÑ Walk-Forward Analysis${NC}"
	@echo -e "${YELLOW}90 p√©riodes test√©es - Standards institutionnels${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.validation.walk_forward_analyzer

.PHONY: validation-oos
validation-oos: ## Out-of-sample validation stricte
	@echo -e "${CYAN}üéØ Out-of-Sample Validation${NC}"
	@echo -e "${YELLOW}Protocole anti-leakage strict${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.validation.oos_validator

.PHONY: validation-unified
validation-unified: ## Validation moteur √©v√©nementiel unifi√©
	@echo -e "${CYAN}‚ö° Moteur √âv√©nementiel Unifi√©${NC}"
	@echo -e "${YELLOW}M√äME moteur walk-forward ET backtest${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.validation.unified_walk_forward

.PHONY: overfitting-detect
overfitting-detect: ## D√©tection overfitting (8 m√©thodes)
	@echo -e "${CYAN}üõ°Ô∏è D√©tection Overfitting${NC}"
	@echo -e "${YELLOW}8 m√©thodes acad√©miques avanc√©es${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.validation.overfitting_detector

.PHONY: backtest-rigorous
backtest-rigorous: ## Backtesting rigoureux complet
	@echo -e "${CYAN}üèõÔ∏è Backtesting Institutionnel${NC}"
	@echo -e "${YELLOW}Pipeline validation complet${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.validation.rigorous_backtester

.PHONY: validation-complete
validation-complete: validation-walkforward validation-oos overfitting-detect ## Validation institutionnelle compl√®te

.PHONY: report-consolidate
report-consolidate: ## Rapport consolid√© pipeline + validation
	@echo -e "${CYAN}üìä Rapport Consolid√©${NC}"
	@echo -e "${YELLOW}Pipeline + Validation institutionnelle${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.reporting.consolidated_reporter

# ==============================================
# M√âTRIQUES & ROBUSTESSE
# ==============================================

.PHONY: metrics-psr
metrics-psr: ## Probabilistic Sharpe Ratio (PSR)
	@echo -e "${CYAN}üìä Probabilistic Sharpe Ratio${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.validation.robustness_metrics

.PHONY: metrics-risk
metrics-risk: ## M√©triques de risque avanc√©es
	@echo -e "${CYAN}üìà Risk Metrics${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.utils.risk_metrics

.PHONY: costs-realistic
costs-realistic: ## Validation co√ªts r√©alistes
	@echo -e "${CYAN}üí∞ Co√ªts R√©alistes${NC}"
	@echo -e "${YELLOW}BTC 0.55% round-trip valid√©${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.utils.realistic_costs

# ==============================================
# PORTFOLIO & S√âLECTION
# ==============================================

.PHONY: portfolio-optimize
portfolio-optimize: ## Optimisation portfolio
	@echo -e "${CYAN}üìà Optimisation Portfolio${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.portfolio.optimizer

.PHONY: selection-psr
selection-psr: ## S√©lection strat√©gies par PSR
	@echo -e "${CYAN}üéØ S√©lection PSR${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.selection.psr_selector

.PHONY: regime-detection
regime-detection: ## D√©tection r√©gimes march√©
	@echo -e "${CYAN}üìä D√©tection R√©gimes${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.selection.regime_detector

# ==============================================
# MLFLOW & TRACKING
# ==============================================

.PHONY: mlflow-start
mlflow-start: ## D√©marrer serveur MLflow (interactif)
	@echo -e "${CYAN}üìà D√©marrage MLflow Server (interactif)${NC}"
	@echo -e "${YELLOW}‚ö†Ô∏è  Utilisez Ctrl+C pour arr√™ter${NC}"
	@source $(VENV_DIR)/bin/activate && mlflow ui --port 5000 --backend-store-uri file:./mlruns

.PHONY: mlflow-start-bg
mlflow-start-bg: ## D√©marrer MLflow en arri√®re-plan
	@echo -e "${CYAN}üìà D√©marrage MLflow Server (background)${NC}"
	@if ! pgrep -f "mlflow ui" > /dev/null; then \
		source $(VENV_DIR)/bin/activate && \
		nohup mlflow ui --port 5000 --backend-store-uri file:./mlruns > mlflow.log 2>&1 & \
		echo $$! > mlflow.pid; \
		echo -e "${GREEN}‚úÖ MLflow d√©marr√© (PID: $$(cat mlflow.pid))${NC}"; \
		echo -e "${YELLOW}üìä Interface: http://localhost:5000${NC}"; \
	else \
		echo -e "${YELLOW}‚ö†Ô∏è  MLflow d√©j√† en cours${NC}"; \
	fi

.PHONY: mlflow-stop
mlflow-stop: ## Arr√™ter MLflow
	@echo -e "${CYAN}üìà Arr√™t MLflow Server${NC}"
	@if [ -f mlflow.pid ]; then \
		kill $$(cat mlflow.pid) 2>/dev/null || true; \
		rm -f mlflow.pid; \
		echo -e "${GREEN}‚úÖ MLflow arr√™t√©${NC}"; \
	else \
		pkill -f "mlflow ui" 2>/dev/null || true; \
		echo -e "${YELLOW}‚ö†Ô∏è  Processus MLflow termin√©s${NC}"; \
	fi

.PHONY: mlflow-status
mlflow-status: ## Statut serveur MLflow
	@echo -e "${CYAN}üìä Statut MLflow${NC}"
	@if pgrep -f "mlflow ui" > /dev/null; then \
		echo -e "${GREEN}‚úÖ MLflow actif sur http://localhost:5000${NC}"; \
	else \
		echo -e "${RED}‚ùå MLflow non d√©marr√©${NC}"; \
	fi

.PHONY: mlflow-track
mlflow-track: ## Tracking exp√©riences MLflow
	@echo -e "${CYAN}üìä MLflow Tracking${NC}"
	@echo -e "${YELLOW}Ouvrez http://localhost:5000${NC}"

.PHONY: mlflow-clean
mlflow-clean: ## Nettoyage donn√©es MLflow
	@echo -e "${CYAN}üßπ Nettoyage MLflow${NC}"
	@rm -rf mlruns/* mlartifacts/*
	@echo -e "${GREEN}‚úÖ MLflow nettoy√©${NC}"

# ==============================================
# MONITORING & ALERTES
# ==============================================

.PHONY: monitor-live
monitor-live: ## Monitoring temps r√©el
	@echo -e "${CYAN}üì° Monitoring Live${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.monitoring.alerting

# Target supprim√© - utiliser monitor-portfolio-final

# ==============================================
# TESTS & BENCHMARKS
# ==============================================

.PHONY: test-async
test-async: ## Tests architecture async
	@echo -e "${CYAN}üß™ Tests Architecture Async${NC}"
	@$(PYTHON) test_async_architecture.py

.PHONY: test-unified
test-unified: ## Tests moteur unifi√©
	@echo -e "${CYAN}‚ö° Tests Moteur Unifi√©${NC}"
	@$(PYTHON) test_unified_walkforward.py

.PHONY: benchmark-async
benchmark-async: ## Benchmark async vs sync
	@echo -e "${CYAN}üìä Benchmark Performance${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) orchestration/benchmark_async_vs_sync.py

.PHONY: test-integration
test-integration: ## Tests int√©gration compl√®te
	@echo -e "${CYAN}üî¨ Tests Int√©gration${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) test_full_integration.py

.PHONY: test-all
test-all: test-async test-unified test-integration ## Tous les tests

# ==============================================
# D√âVELOPPEMENT
# ==============================================

.PHONY: dev-jupyter
dev-jupyter: ## Lancer Jupyter pour d√©veloppement
	@echo -e "${CYAN}üìì Jupyter Notebook${NC}"
	@source $(VENV_DIR)/bin/activate && jupyter lab

.PHONY: dev-format
dev-format: ## Formatage code (black)
	@echo -e "${CYAN}üé® Formatage Code${NC}"
	@source $(VENV_DIR)/bin/activate && black .

.PHONY: dev-lint
dev-lint: ## Linting code (flake8)
	@echo -e "${CYAN}üîç Linting Code${NC}"
	@source $(VENV_DIR)/bin/activate && flake8 .

# ==============================================
# STATUS & INFO
# ==============================================

.PHONY: status
status: ## Statut complet du framework
	@echo -e "${CYAN}================================================================${NC}"
	@echo -e "${CYAN}    üìä STATUS FRAMEWORK QUANTITATIF PRODUCTION${NC}"
	@echo -e "${CYAN}================================================================${NC}"
	@echo ""
	@echo -e "${PURPLE}üèóÔ∏è Architecture:${NC}"
	@echo -e "  ‚ö° Async native: UN SEUL asyncio.run() ‚úÖ"
	@echo -e "  üéØ Moteur √©v√©nementiel unifi√© ‚úÖ"
	@echo -e "  üìä 29 modules Python - 13,000+ lignes ‚úÖ"
	@echo -e "  üèõÔ∏è Standards institutionnels ‚úÖ"
	@echo ""
	@echo -e "${PURPLE}üìà Pipeline:${NC}"
	@echo -e "  üìä Collecte donn√©es crypto ‚úÖ"
	@echo -e "  üîß Feature engineering avanc√© ‚úÖ"  
	@echo -e "  üß† 3 strat√©gies alpha sophistiqu√©es ‚úÖ"
	@echo -e "  üèõÔ∏è Validation institutionnelle ‚úÖ"
	@echo ""
	@echo -e "${PURPLE}üéØ Validation:${NC}"
	@echo -e "  üîÑ Walk-forward (90 p√©riodes) ‚úÖ"
	@echo -e "  üéØ Out-of-sample strict ‚úÖ"
	@echo -e "  üõ°Ô∏è Overfitting detection (8 m√©thodes) ‚úÖ"
	@echo -e "  üìä PSR/DSR standards industrie ‚úÖ"
	@echo ""
	@echo -e "${PURPLE}üí∞ Trading:${NC}"
	@echo -e "  üí± APIs crypto (Binance/OKX) ‚úÖ"
	@echo -e "  üí∞ Co√ªts r√©alistes int√©gr√©s ‚úÖ"
	@echo -e "  üìà Portfolio optimization ‚úÖ"
	@echo -e "  üì° Monitoring temps r√©el ‚úÖ"
	@echo ""
	@echo -e "${GREEN}üèÜ Framework Production-Ready - Niveau Institutionnel${NC}"

.PHONY: info
info: ## Informations framework
	@echo -e "${CYAN}‚ÑπÔ∏è FRAMEWORK QUANTITATIF INFO${NC}"
	@echo "Modules Python: $$(find mlpipeline -name '*.py' | wc -l)"
	@echo "Lignes de code: $$(find mlpipeline -name '*.py' -exec wc -l {} + | tail -1 | awk '{print $$1}')"
	@echo "Tests: $$(find . -name 'test_*.py' | wc -l)"
	@echo "Configuration: $$(find config -name '*.yml' | wc -l) files"

# ==============================================
# MAINTENANCE
# ==============================================

.PHONY: clean-cache
clean-cache: ## Nettoyage caches Python
	@echo -e "${CYAN}üßπ Nettoyage Caches${NC}"
	@find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	@find . -type f -name "*.pyc" -delete 2>/dev/null || true
	@rm -rf .pytest_cache 2>/dev/null || true
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.utils.artifact_cleaner --project-root . --dry-run

.PHONY: clean-symbols
clean-symbols: ## Nettoyage artifacts par symboles (ex: make clean-symbols SYMBOLS="BTCUSDT ETHUSDT")
	@echo -e "${CYAN}üßπ Nettoyage Artifacts par Symboles${NC}"
	@echo -e "${YELLOW}Symboles: $(SYMBOLS)${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.utils.artifact_cleaner --project-root . --symbols $(SYMBOLS)

.PHONY: clean-timeframes
clean-timeframes: ## Nettoyage artifacts par timeframes (ex: make clean-timeframes TIMEFRAMES="1h 4h")
	@echo -e "${CYAN}üßπ Nettoyage Artifacts par Timeframes${NC}"
	@echo -e "${YELLOW}Timeframes: $(TIMEFRAMES)${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.utils.artifact_cleaner --project-root . --timeframes $(TIMEFRAMES)

.PHONY: clean-selective
clean-selective: ## Nettoyage s√©lectif (ex: make clean-selective SYMBOLS="BTCUSDT" TIMEFRAMES="1h")
	@echo -e "${CYAN}üßπ Nettoyage S√©lectif${NC}"
	@echo -e "${YELLOW}Symboles: $(SYMBOLS) | Timeframes: $(TIMEFRAMES)${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.utils.artifact_cleaner --project-root . --symbols $(SYMBOLS) --timeframes $(TIMEFRAMES)

.PHONY: select-crypto
select-crypto: ## S√©lecteur interactif de cryptos et timeframes
	@echo -e "${CYAN}üöÄ S√©lecteur Crypto Interactif${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) -m mlpipeline.utils.crypto_selector

.PHONY: monitor-portfolio-final
monitor-portfolio-final: ## Monitoring final du portfolio
	@echo -e "${CYAN}üìä Portfolio Monitoring Final${NC}"
	@echo -e "${YELLOW}Dashboard temps r√©el${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) /home/jim/DEV/claude-code/quant-stack-production/mlpipeline/monitoring/portfolio_monitor.py

.PHONY: features-export-final
features-export-final: ## Export features pour analyse externe
	@echo -e "${CYAN}üì§ Features Export Final${NC}"
	@echo -e "${YELLOW}Formats: CSV${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) /home/jim/DEV/claude-code/quant-stack-production/mlpipeline/export/features_exporter.py --formats csv

.PHONY: workflow-optimized
workflow-optimized: ## Workflow optimis√© avec monitoring des performances
	@echo -e "${CYAN}üöÄ Workflow Optimis√©${NC}"
	@echo -e "${YELLOW}Monitoring performances activ√©${NC}"
	@source $(VENV_DIR)/bin/activate && $(PYTHON) /home/jim/DEV/claude-code/quant-stack-production/mlpipeline/utils/workflow_optimizer.py

.PHONY: clean-data
clean-data: ## Nettoyage donn√©es temporaires
	@echo -e "${CYAN}üßπ Nettoyage Donn√©es${NC}"
	@rm -rf cache/* logs/* data/processed/* 2>/dev/null || true

.PHONY: clean-all
clean-all: clean-cache clean-data mlflow-clean ## Nettoyage complet
	@echo -e "${GREEN}‚úÖ Nettoyage complet termin√©${NC}"

.PHONY: backup-results
backup-results: ## Sauvegarde r√©sultats
	@echo -e "${CYAN}üíæ Sauvegarde R√©sultats${NC}"
	@mkdir -p backup/$$(date +%Y%m%d_%H%M%S)
	@cp -r mlruns data/artifacts logs backup/$$(date +%Y%m%d_%H%M%S)/ 2>/dev/null || true
	@echo -e "${GREEN}‚úÖ Sauvegarde cr√©√©e${NC}"

# ==============================================
# RACCOURCIS POPULAIRES
# ==============================================

.PHONY: start
start: pipeline-demo ## Alias pour pipeline-demo

.PHONY: run
run: pipeline-full ## Alias pour pipeline-full

.PHONY: install
install: setup-complete ## Alias pour setup-complete

.PHONY: validate
validate: validation-complete ## Alias pour validation-complete

.PHONY: test
test: test-all ## Alias pour test-all